# BCRG - Ballistic reticle generator

### Simple tool to generate dynamic ballistics reticles by .lua templates

[<img src="https://flagicons.lipis.dev/flags/4x3/gb.svg" width="20"/> **English**](./README.md)

-----

## Installation üöÄ

–í—Å—Ç–∞–Ω–æ–≤—ñ—Ç—å –≥–µ–Ω–µ—Ä–∞—Ç–æ—Ä –±–∞–ª—ñ—Å—Ç–∏—á–Ω–∏—Ö —Å—ñ—Ç–æ–∫ **BCRG** –∑–∞ –¥–æ–ø–æ–º–æ–≥–æ—é `pip` (—Å—Ç–∞–Ω–¥–∞—Ä—Ç–Ω–∏–π –º–µ—Ç–æ–¥) –∞–±–æ –Ω–æ–≤—ñ—à–æ–≥–æ —ñ–Ω—Å—Ç—Ä—É–º–µ–Ω—Ç—É `uv` (—Ä–µ–∫–æ–º–µ–Ω–¥–æ–≤–∞–Ω–æ –¥–ª—è —à–≤–∏–¥–∫–æ—ó —Ä–æ–±–æ—Ç–∏).

### –í—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–Ω—è —Ç–∞ –û–Ω–æ–≤–ª–µ–Ω–Ω—è –∑–∞ –¥–æ–ø–æ–º–æ–≥–æ—é uv (–†–µ–∫–æ–º–µ–Ω–¥–æ–≤–∞–Ω–æ)

–Ø–∫—â–æ –≤–∏ –≤–∏–∫–æ—Ä–∏—Å—Ç–æ–≤—É—î—Ç–µ **uv**, –≤–∏ –º–æ–∂–µ—Ç–µ –∫–µ—Ä—É–≤–∞—Ç–∏ —ñ–Ω—Å—Ç—Ä—É–º–µ–Ω—Ç–æ–º –Ω–∞–ø—Ä—è–º—É:

**–í—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–Ω—è:**

```bash
uv tool install bcrg
```

**–û–Ω–æ–≤–ª–µ–Ω–Ω—è:**

```bash
uv tool upgrade bcrg
```

### –í—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–Ω—è –∑–∞ –¥–æ–ø–æ–º–æ–≥–æ—é pip (–°—Ç–∞–Ω–¥–∞—Ä—Ç–Ω–∏–π –º–µ—Ç–æ–¥)

–Ø–∫—â–æ –≤–∏ –≤–∏–∫–æ—Ä–∏—Å—Ç–æ–≤—É—î—Ç–µ —Å—Ç–∞–Ω–¥–∞—Ä—Ç–Ω–∏–π Python-–º–µ–Ω–µ–¥–∂–µ—Ä –ø–∞–∫–µ—Ç—ñ–≤:

```bash
pip install bcrg
```

**–û–Ω–æ–≤–ª–µ–Ω–Ω—è:**

```bash
pip install --upgrade bcrg
```

-----

## Usage (–í–∏–∫–æ—Ä–∏—Å—Ç–∞–Ω–Ω—è)

### As CLI tool (–ß–µ—Ä–µ–∑ –∫–æ–º–∞–Ω–¥–Ω–∏–π —Ä—è–¥–æ–∫)

–í–∏–∫–æ—Ä–∏—Å—Ç–æ–≤—É–π—Ç–µ `bcrg` or `python -m bcrg` –¥–ª—è –≥–µ–Ω–µ—Ä–∞—Ü—ñ—ó –∑–æ–±—Ä–∞–∂–µ–Ω—å —Å—ñ—Ç–æ–∫ (BMP) –∑ Lua-—à–∞–±–ª–æ–Ω—ñ–≤:

```bash
usage: bcr [-h] [-o OUTPUT] [-f] [-W <int>] [-H <int>] [-cx <float>] [-cy <float>] [-z [<int> ...]] [-T | -Z] file

positional arguments:
  file                  Reticle template file in .lua format

options:
  -h, --help            show this help message and exit
  -o OUTPUT, --output OUTPUT
                        Output directory path, defaults to ./
  -f, --force           Force overwrite existing files without prompt
  -W <int>, --width <int>
                        Canvas width (px)
  -H <int>, --height <int>
                        Canvas height (px)
  -cx <float>, --click-x <float>
                        Horizontal click size (cm/100m)
  -cy <float>, --click-y <float>
                        Vertical click size (cm/100m)
  -z [<int> ...], --zoom [<int> ...]
                        Zoom value (int)
  -V, --version         show program\'s version number and exit

archiving options:
  -T, --tar             Store as .tar.gz (overrides --zip)
  -Z, --zip             Store as .zip
```

### As Imported module (–Ø–∫ —ñ–º–ø–æ—Ä—Ç–æ–≤–∞–Ω–∏–π –º–æ–¥—É–ª—å)

–í–∏ –º–æ–∂–µ—Ç–µ —ñ–Ω—Ç–µ–≥—Ä—É–≤–∞—Ç–∏ –≥–µ–Ω–µ—Ä–∞—Ç–æ—Ä –±–µ–∑–ø–æ—Å–µ—Ä–µ–¥–Ω—å–æ —É –≤–∞—à Python-–∫–æ–¥:

```python
from bcrg import LuaReticleLoader
loader = LuaReticleLoader('my_reticle_template.lua')

# Create 1bit-depth .bmp bytearray
byte_stream = loader.make_bmp(640, 480, 2.27, 2.27, 4, None)
with open("myreticle.bmp", 'wb') as f:
    f.write(byte_stream)
```

### References (–î–æ–≤—ñ–¥–∫–æ–≤–∞ —ñ–Ω—Ñ–æ—Ä–º–∞—Ü—ñ—è)

  * A reticle template have to implement `make_reticle` function, that gets required arguments and have to return `self:to_bmp` or `self:to_bmp_1bit`.
  * Examples in `./templates` dir.

-----

## üìê Reticle Template API (Lua)

–¶–µ–π —Ä–æ–∑–¥—ñ–ª –¥–µ—Ç–∞–ª—å–Ω–æ –æ–ø–∏—Å—É—î, —è–∫ —Å—Ç–≤–æ—Ä—é–≤–∞—Ç–∏ Lua-—à–∞–±–ª–æ–Ω–∏, –≤–∏–∫–æ—Ä–∏—Å—Ç–æ–≤—É—é—á–∏ –±—ñ–±–ª—ñ–æ—Ç–µ–∫—É **ReticleDraw**.

### üõ†Ô∏è –°—Ç—Ä—É–∫—Ç—É—Ä–∞ –§–∞–π–ª—ñ–≤ –°—ñ—Ç–∫–∏ —Ç–∞ `make_reticle`

–ö–æ–∂–µ–Ω —Ñ–∞–π–ª —Å—ñ—Ç–∫–∏ –æ–±–æ–≤'—è–∑–∫–æ–≤–æ –º–∞—î –¥–µ–∫–ª–∞—Ä—É–≤–∞—Ç–∏ –∑–∞–ª–µ–∂–Ω—ñ—Å—Ç—å –≤—ñ–¥ `reticledraw`

```lua
-- –ó–∞–≤–∞–Ω—Ç–∞–∂—É—î–º–æ framebuffer –º–æ–¥—É–ª—å
require("reticledraw") -- üëà –¶–ï–ô –†–Ø–î–û–ö –Ñ –ö–õ–Æ–ß–û–í–ò–ú!
```

–ö–æ–∂–µ–Ω —Ñ–∞–π–ª —Å—ñ—Ç–∫–∏ –ø–æ–≤–∏–Ω–µ–Ω –º—ñ—Å—Ç–∏—Ç–∏ —î–¥–∏–Ω—É —Ñ—É–Ω–∫—Ü—ñ—é `make_reticle`.

```lua
function make_reticle(width, height, click_x, click_y, zoom, adjustment)
    -- ... –í–∞—à –∫–æ–¥ –º–∞–ª—é–≤–∞–Ω–Ω—è ...
end
```

| –ü–∞—Ä–∞–º–µ—Ç—Ä | –¢–∏–ø | –û–ø–∏—Å |
| :--- | :--- | :--- |
| **`click_x`** | `number` | **–¶—ñ–Ω–∞ –∫–ª—ñ–∫—É (Correction Value)** –ø–æ –æ—Å—ñ X. |
| **`zoom`** | `number` | –ü–æ—Ç–æ—á–Ω–µ **–∑–±—ñ–ª—å—à–µ–Ω–Ω—è** –ø—Ä–∏—Ü—ñ–ª—É. |
| **`adjustment`** | `table` | –î–æ–¥–∞—Ç–∫–æ–≤—ñ –ø–∞—Ä–∞–º–µ—Ç—Ä–∏/–Ω–∞—Å—Ç—Ä–æ–π–∫–∏ —Å—ñ—Ç–∫–∏. |

### üöÄ –ó–∞–≥–∞–ª—å–Ω–∏–π –®–∞–±–ª–æ–Ω –ö–æ–¥—É —Ç–∞ –õ–æ–≥—ñ–∫–∞ –ú–∞—Å—à—Ç–∞–±—É–≤–∞–Ω–Ω—è (–ó –ü—Ä–∏–∫–ª–∞–¥–∞–º–∏)

–í–∏–∫–æ—Ä–∏—Å—Ç–æ–≤—É–π—Ç–µ –∫–æ–µ—Ñ—ñ—Ü—ñ—î–Ω—Ç–∏ `ax/ay` —Ç–∞ —Ñ—É–Ω–∫—Ü—ñ—ó `_x(v)`/`_y(v)` –¥–ª—è –ø–µ—Ä–µ—Ç–≤–æ—Ä–µ–Ω–Ω—è **–æ–¥–∏–Ω–∏—Ü—å –ø—Ä–∏—Ü—ñ–ª—É** (MILs/MOAs) —É **–ø—ñ–∫—Å–µ–ª—ñ –µ–∫—Ä–∞–Ω–∞**.

```lua
require("reticledraw")

local BLACK = 0
local WHITE = 1

-- –§—É–Ω–∫—Ü—ñ—è –æ–∫—Ä—É–≥–ª–µ–Ω–Ω—è (–∑–∞–±–µ–∑–ø–µ—á—É—î, —â–æ –ø—ñ–∫—Å–µ–ª—å –±—É–¥–µ —Ü—ñ–ª–∏–º)
local function round(v)
    if v < 0 then
        return math.ceil(v)
    elseif v > 0 then
        return math.floor(v)
    else
        return 0
    end
end

function make_reticle(width, height, click_x, click_y, zoom, adjustment)
    -- 1. –û–±—á–∏—Å–ª–µ–Ω–Ω—è –∫–æ–µ—Ñ—ñ—Ü—ñ—î–Ω—Ç—ñ–≤ –º–∞—Å—à—Ç–∞–±—É–≤–∞–Ω–Ω—è (AX, AY)
    local ax = click_x / zoom
    local ay = click_y / zoom

    -- 2. –î–æ–ø–æ–º—ñ–∂–Ω—ñ —Ñ—É–Ω–∫—Ü—ñ—ó: –ø–µ—Ä–µ—Ç–≤–æ—Ä—é—é—Ç—å –æ–¥–∏–Ω–∏—Ü—ñ –ø—Ä–∏—Ü—ñ–ª—É (v) –≤ –ø—ñ–∫—Å–µ–ª—ñ
    local function _x(v)
        return round(v / ax)
    end
    local function _y(v)
        return round(v / ay)
    end

    local fb = make_canvas(width, height, 1)
    fb:fill(WHITE)

    -- 3. –ü—Ä–∏–∫–ª–∞–¥–∏ –º–∞–ª—é–≤–∞–Ω–Ω—è –µ–ª–µ–º–µ–Ω—Ç—ñ–≤ —Å—ñ—Ç–∫–∏:

    -- –¶–µ–Ω—Ç—Ä–∞–ª—å–Ω–∞ —Ç–æ—á–∫–∞ (3x3 –ø—ñ–∫—Å–µ–ª—ñ)
    fb:c_fill_rect(0, 0, 3, 3, BLACK) 

    -- –ì–æ–ª–æ–≤–Ω–∞ –≥–æ—Ä–∏–∑–æ–Ω—Ç–∞–ª—å–Ω–∞ –ª—ñ–Ω—ñ—è (–≤—ñ–¥ -100 –¥–æ +100 –æ–¥–∏–Ω–∏—Ü—å)
    fb:c_line(_x(-100), 0, _x(100), 0, BLACK) 
    
    -- –î–∏–Ω–∞–º—ñ—á–Ω—ñ –º—ñ—Ç–∫–∏: –º–∞–ª—é—î–º–æ –ª—ñ–Ω—ñ—ó –∫–æ–∂–Ω—ñ 10 –æ–¥–∏–Ω–∏—Ü—å
    local marker_length = 5 -- –¥–æ–≤–∂–∏–Ω–∞ –º—ñ—Ç–∫–∏ —É –ø—ñ–∫—Å–µ–ª—è—Ö
    local marker_step = 10  -- –∫—Ä–æ–∫ —É –æ–¥–∏–Ω–∏—Ü—è—Ö –ø—Ä–∏—Ü—ñ–ª—É (MILs/MOAs)
    
    for i = marker_step, 50, marker_step do
        -- –õ—ñ–Ω—ñ—è –≤–≥–æ—Ä—É
        fb:c_vline(_x(0), _y(i), marker_length, BLACK) 
        -- –õ—ñ–Ω—ñ—è –≤–Ω–∏–∑
        fb:c_vline(_x(0), _y(-i), marker_length, BLACK) 
        
        -- –¶–∏—Ñ—Ä–æ–≤—ñ –º—ñ—Ç–∫–∏ (–≤–∏–∫–æ—Ä–∏—Å—Ç–æ–≤—É—î–º–æ 6x6 —à—Ä–∏—Ñ—Ç)
        fb:c_text6(tostring(i), _x(5), _y(i), BLACK)
    end

    -- –î–∏–Ω–∞–º—ñ—á–Ω–∞ –∞–¥–∞–ø—Ç–∞—Ü—ñ—è –¥–µ—Ç–∞–ª—ñ–∑–∞—Ü—ñ—ó
    -- –Ø–∫—â–æ –∑–±—ñ–ª—å—à–µ–Ω–Ω—è –≤–∏—Å–æ–∫–µ (ax < 0.5), –º–∞–ª—é—î–º–æ –¥–æ–¥–∞—Ç–∫–æ–≤—ñ –º—ñ—Ç–∫–∏ –∫–æ–∂–Ω—ñ 5 –æ–¥–∏–Ω–∏—Ü—å
    if ax < 0.5 then
        for i = 5, 50, 5 do
            -- –ú–∞–ª–µ–Ω—å–∫–∞ —Ç–æ—á–∫–∞ –Ω–∞ 5 –æ–¥–∏–Ω–∏—Ü—å –ø—Ä–∞–≤–æ—Ä—É—á
            fb:c_pixel(_x(i), _y(-5), BLACK) 
        end
    end
    
    return fb 
end
```

### üé® –ú–µ—Ç–æ–¥–∏ ReticleDraw (–¶–µ–Ω—Ç—Ä–æ–≤–∞–Ω—ñ –ö–æ–æ—Ä–¥–∏–Ω–∞—Ç–∏)

–¶—ñ –º–µ—Ç–æ–¥–∏ –∞–≤—Ç–æ–º–∞—Ç–∏—á–Ω–æ –º–∞–ª—é—é—Ç—å –≤—ñ–¥–Ω–æ—Å–Ω–æ —Ü–µ–Ω—Ç—Ä—É –¥–∏—Å–ø–ª–µ—è (`0,0`).

| –ú–µ—Ç–æ–¥ | –û–ø–∏—Å | –ü—Ä–∏–∫–ª–∞–¥ |
| :--- | :--- | :--- |
| **`fb:c_pixel(x, y, color)`** | –ú–∞–ª—é—î –æ–¥–∏–Ω –ø—ñ–∫—Å–µ–ª—å. | `fb:c_pixel(_x(10), _y(10), BLACK)` |
| **`fb:c_line(x0, y0, x1, y1, color)`** | –ú–∞–ª—é—î –ª—ñ–Ω—ñ—é. | `fb:c_line(0, 0, _x(50), 0, BLACK)` |
| **`fb:c_hline(x, y, width, color)`** | –ú–∞–ª—é—î –≥–æ—Ä–∏–∑–æ–Ω—Ç–∞–ª—å–Ω—É –ª—ñ–Ω—ñ—é. | `fb:c_hline(_x(-50), _y(20), _x(100), BLACK)` |
| **`fb:c_vline(x, y, height, color)`** | –ú–∞–ª—é—î –≤–µ—Ä—Ç–∏–∫–∞–ª—å–Ω—É –ª—ñ–Ω—ñ—é. | `fb:c_vline(_x(30), _y(-50), _y(100), BLACK)` |
| **`fb:c_rect(x, y, w, h, color)`** | –ú–∞–ª—é—î –∫–æ–Ω—Ç—É—Ä –ø—Ä—è–º–æ–∫—É—Ç–Ω–∏–∫–∞ (—Ü–µ–Ω—Ç—Ä `x, y`). | `fb:c_rect(_x(10), _y(10), 20, 20, BLACK)` |
| **`fb:c_fill_rect(x, y, w, h, color)`**| –ú–∞–ª—é—î –∑–∞–ø–æ–≤–Ω–µ–Ω–∏–π –ø—Ä—è–º–æ–∫—É—Ç–Ω–∏–∫. | `fb:c_fill_rect(0, 0, 3, 3, BLACK)` |
| **`fb:c_circle(x, y, r, color)`** | –ú–∞–ª—é—î –∫–æ–Ω—Ç—É—Ä –∫–æ–ª–∞. `r` ‚Äî —Ä–∞–¥—ñ—É—Å —É **–ø—ñ–∫—Å–µ–ª—è—Ö**. | `fb:c_circle(0, _y(30), 5, BLACK)` |
| **`fb:c_fill_circle(x, y, r, color)`** | –ú–∞–ª—é—î –∑–∞–ø–æ–≤–Ω–µ–Ω–µ –∫–æ–ª–æ. | `fb:c_fill_circle(0, 0, 2, BLACK)` |
| **`fb:c_text6(s, x, y, color)`** | –ú–∞–ª—é—î —Ç–µ–∫—Å—Ç —à—Ä–∏—Ñ—Ç–æ–º **6x6** –ø—ñ–∫—Å–µ–ª—ñ–≤. | `fb:c_text6("10", _x(10), _y(-10), BLACK)` |

### üìê –£—Å–ø–∞–¥–∫–æ–≤–∞–Ω—ñ –ú–µ—Ç–æ–¥–∏ FrameBuffer (–ê–±—Å–æ–ª—é—Ç–Ω—ñ –ö–æ–æ—Ä–¥–∏–Ω–∞—Ç–∏)

–¶—ñ –º–µ—Ç–æ–¥–∏ –≤–∏–º–∞–≥–∞—é—Ç—å **–∞–±—Å–æ–ª—é—Ç–Ω–∏—Ö –ø—ñ–∫—Å–µ–ª—å–Ω–∏—Ö –∫–æ–æ—Ä–¥–∏–Ω–∞—Ç** (`0,0` ‚Äî –≤–µ—Ä—Ö–Ω—ñ–π –ª—ñ–≤–∏–π –∫—É—Ç).

| –ú–µ—Ç–æ–¥ | –í–∏–º–æ–≥–∏ –¥–æ –∫–æ–æ—Ä–¥–∏–Ω–∞—Ç | –û–ø–∏—Å |
| :--- | :--- | :--- |
| **`fb:pixel(x, y, color)`** | –ê–±—Å–æ–ª—é—Ç–Ω—ñ | –í—Å—Ç–∞–Ω–æ–≤–ª—é—î –∫–æ–ª—ñ—Ä –ø—ñ–∫—Å–µ–ª—è. |
| **`fb:fill(color)`** | –ê–±—Å–æ–ª—é—Ç–Ω—ñ | –ó–∞–ª–∏–≤–∞—î –≤–µ—Å—å –±—É—Ñ–µ—Ä. |
| **`fb:fill_rect(x, y, w, h, c)`** | –ê–±—Å–æ–ª—é—Ç–Ω—ñ | –ó–∞–ª–∏–≤–∞—î –ø—Ä—è–º–æ–∫—É—Ç–Ω–∏–∫. |
| **`fb:rect(x, y, w, h, c)`** | –ê–±—Å–æ–ª—é—Ç–Ω—ñ | –ú–∞–ª—é—î –∫–æ–Ω—Ç—É—Ä –ø—Ä—è–º–æ–∫—É—Ç–Ω–∏–∫–∞. |
| **`fb:line(x0, y0, x1, y1, color)`**| –ê–±—Å–æ–ª—é—Ç–Ω—ñ | –ú–∞–ª—é—î –¥–æ–≤—ñ–ª—å–Ω—É –ª—ñ–Ω—ñ—é. |
| **`fb:hline(x, y, w, color)`** | –ê–±—Å–æ–ª—é—Ç–Ω—ñ | –ú–∞–ª—é—î –≥–æ—Ä–∏–∑–æ–Ω—Ç–∞–ª—å–Ω—É –ª—ñ–Ω—ñ—é. |
| **`fb:vline(x, y, h, color)`** | –ê–±—Å–æ–ª—é—Ç–Ω—ñ | –ú–∞–ª—é—î –≤–µ—Ä—Ç–∏–∫–∞–ª—å–Ω—É –ª—ñ–Ω—ñ—é. |
| **`fb:circle(x, y, r, color)`** | –ê–±—Å–æ–ª—é—Ç–Ω—ñ | –ú–∞–ª—é—î –∫–æ–Ω—Ç—É—Ä –∫–æ–ª–∞. |
| **`fb:fill_circle(x, y, r, color)`** | –ê–±—Å–æ–ª—é—Ç–Ω—ñ | –ú–∞–ª—é—î –∑–∞–ø–æ–≤–Ω–µ–Ω–µ –∫–æ–ª–æ. |
| **`fb:ellipse(x, y, rx, ry, color)`** | –ê–±—Å–æ–ª—é—Ç–Ω—ñ | –ú–∞–ª—é—î –∫–æ–Ω—Ç—É—Ä –µ–ª—ñ–ø—Å–∞. |
| **`fb:polygon(points, color)`** | –ê–±—Å–æ–ª—é—Ç–Ω—ñ | –ú–∞–ª—é—î –∑–∞–ø–æ–≤–Ω–µ–Ω–∏–π –±–∞–≥–∞—Ç–æ–∫—É—Ç–Ω–∏–∫. |
| **`fb:text(s, x0, y0, col)`** | –ê–±—Å–æ–ª—é—Ç–Ω—ñ | –ú–∞–ª—é—î —Ç–µ–∫—Å—Ç —Å—Ç–∞–Ω–¥–∞—Ä—Ç–Ω–∏–º —à—Ä–∏—Ñ—Ç–æ–º **8x8** –ø—ñ–∫—Å–µ–ª—ñ–≤. |